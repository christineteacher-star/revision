<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Académie | Monte-Cristo Chap. 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background-color: #f8fafc; margin: 0; height: 100vh; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .game-card { width: 100%; max-width: 480px; background: white; height: 95vh; display: flex; flex-direction: column; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .img-box { width: 100%; height: 25vh; background: #4338ca; display: flex; align-items: center; justify-content: center; overflow: hidden; border-bottom: 1px solid #f1f5f9; position: relative; }
        .img-box i { color: rgba(255,255,255,0.2); font-size: 5rem; }
        .quiz-body { padding: 20px; flex: 1; display: flex; flex-direction: column; text-align: center; }
        .question-text { font-size: 1.05rem; font-weight: 800; color: #1e293b; margin: 10px 0; min-height: 3.5rem; line-height: 1.3; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .opt-btn { background: #fdfdfd; border: 2px solid #e2e8f0; padding: 10px 6px; border-radius: 16px; font-weight: 700; color: #475569; cursor: pointer; transition: all 0.2s; min-height: 55px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .animate-error { animation: shake 0.4s ease-in-out; border-color: #ef4444 !important; background: #fef2f2 !important; color: #b91c1c !important; }
        .animate-correct { animation: pop 0.4s ease-in-out; border-color: #22c55e !important; background: #f0fdf4 !important; color: #15803d !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-8px); } 60% { transform: translateX(8px); } }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
        .feedback-box { display: none; margin-top: 15px; padding: 12px; border-radius: 15px; font-size: 0.8rem; line-height: 1.4; font-weight: 600; text-align: left; }
        .is-correct { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
        .is-wrong { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .btn-next { background: #6366f1; color: white; width: 100%; padding: 16px; border-radius: 18px; font-weight: 800; text-transform: uppercase; margin-top: auto; box-shadow: 0 4px 0 #4338ca; display: none; cursor: pointer; text-align: center; }
    </style>
</head>
<body>

    <div class="game-card">
        <header class="p-4 flex justify-between items-center border-b border-slate-100">
            <div class="flex items-center gap-2 text-indigo-600 font-black text-sm uppercase">
                <i class="fas fa-feather-alt"></i> Mon Académie
            </div>
            <span class="bg-indigo-50 text-indigo-600 text-[10px] font-bold px-3 py-1 rounded-full border border-indigo-100 uppercase">Chapitre 2</span>
        </header>

        <div class="h-1.5 bg-slate-100"><div id="progress-bar" class="h-full bg-indigo-500 w-0 transition-all duration-500"></div></div>
        
        <div class="img-box">
            <i class="fas fa-user-secret"></i>
            <div class="absolute inset-0 flex items-center justify-center text-white font-black text-xl bg-black/20 uppercase tracking-widest">
                La Trahison
            </div>
        </div>

        <div class="quiz-body" id="quiz-ui">
            <div id="q-counter" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Question 1 / 10</div>
            <h2 id="q-text" class="question-text">Chargement...</h2>
            <div id="grid" class="options-grid"></div>
            <div id="feedback" class="feedback-box"></div>
            <div id="next-btn" onclick="goToNext()" class="btn-next">Continuer <i class="fas fa-arrow-right ml-2"></i></div>
        </div>
    </div>

<script>
    const quizData = [
        { q: "Pourquoi Fernand est-il déçu et triste au début du chapitre ?", opts: ["Il a perdu son travail", "Mercédès refuse de l'épouser", "Edmond l'a frappé", "Il est malade"], r: "Mercédès refuse de l'épouser", def: "Mercédès lui dit qu'elle l'aime comme un frère, mais pas d'amour." },
        { q: "Mercédès dit à Fernand : 'Mon coeur bat pour ________.'", opts: ["Un autre", "Personne", "Toi", "Ma famille"], r: "Un autre", def: "Elle confirme son amour exclusif pour Edmond Dantès." },
        { q: "Quelle est la réaction de Fernand quand Edmond arrive ?", opts: ["Il l'embrasse", "Il lui sourit", "Il se détourne", "Il s'enfuit en courant"], r: "Il se détourne", def: "Dantès lui tend la main, mais Fernand refuse de le saluer normalement." },
        { q: "Dans quel état se trouve Caderousse au café ?", opts: ["Très en colère", "Un peu ivre", "Très joyeux", "Endormi"], r: "Un peu ivre", def: "Le texte précise qu'il boit de l'alcool sous un platane avec Danglars." },
        { q: "Selon Danglars, de quoi Fernand et Caderousse sont-ils 'ivres' ?", opts: ["D'eau et de vin", "D'alcool et d'amour", "De haine et de peur", "De joie et d'espoir"], r: "D'alcool et d'amour", def: "Caderousse boit trop, et Fernand est aveuglé par son amour pour Mercédès." },
        { q: "Que propose Danglars pour empêcher le mariage ?", opts: ["Tuer Edmond", "L'envoyer en prison", "Le faire repartir en mer", "L'empoisonner"], r: "L'envoyer en prison", def: "Danglars dit : 'Il suffit que les murs d'une prison les séparent'." },
        { q: "Comment Danglars déguise-t-il son écriture sur la lettre ?", opts: ["Il écrit en attaché", "Il utilise du sang", "Il écrit de la main gauche", "Il utilise des majuscules"], r: "Il écrit de la main gauche", def: "Il utilise sa main gauche pour masquer son écriture habituelle." },
        { q: "La lettre dénonce Edmond comme étant un ________.", opts: ["Voleur de navire", "Meurtrier", "Agent bonapartiste", "Traître à l'armateur"], r: "Agent bonapartiste", def: "L'accusation porte sur ses relations avec Napoléon à l'île d'Elbe." },
        { q: "Où Danglars jette-t-il la lettre après l'avoir froissée ?", opts: ["Dans la mer", "Dans le feu", "Sous la table", "Dans sa poche"], r: "Sous la table", def: "Il fait semblant de la jeter pour que Fernand la ramasse lui-même." },
        { q: "Que fait Fernand à la toute fin du chapitre ?", opts: ["Il déchire la lettre", "Il la récupère discrètement", "Il part pleurer", "Il va voir Mercédès"], r: "Il la récupère discrètement", def: "Il ramasse la lettre jetée par Danglars pour l'utiliser." }
    ];

    let currentQ = 0;
    let score = 0;

    function loadQuestion() {
        const data = quizData[currentQ];
        document.getElementById('q-text').innerText = data.q;
        document.getElementById('q-counter').innerText = `Question ${currentQ + 1} / 10`;
        document.getElementById('progress-bar').style.width = ((currentQ / 10) * 100) + "%";
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        data.opts.forEach(choice => {
            const btn = document.createElement('div');
            btn.className = "opt-btn";
            btn.innerText = choice;
            btn.onclick = () => verify(btn, choice, data.r, data.def);
            grid.appendChild(btn);
        });
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
    }

    function verify(el, choice, correct, definition) {
        const fb = document.getElementById('feedback');
        document.querySelectorAll('.opt-btn').forEach(b => b.onclick = null);
        fb.style.display = 'block';
        if (choice === correct) {
            el.classList.add('animate-correct');
            fb.className = "feedback-box is-correct";
            fb.innerHTML = `✅ CORRECT ! <br> ${definition}`;
            score++;
        } else {
            el.classList.add('animate-error');
            fb.className = "feedback-box is-wrong";
            fb.innerHTML = `❌ ERREUR <br> ${definition}`;
            document.querySelectorAll('.opt-btn').forEach(b => {
                if(b.innerText === correct) b.style.borderColor = "#22c55e";
            });
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function goToNext() {
        currentQ++;
        if (currentQ < quizData.length) {
            loadQuestion();
        } else {
            showEnd();
        }
    }

    function showEnd() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        
        setTimeout(() => {
            const pseudo = prompt("Bravo ! Quel est ton nom pour le classement ?") || "Anonyme";
            envoyerResultat(pseudo, score);
            
            document.getElementById('quiz-ui').innerHTML = `
                <div class="py-10">
                    <div class="text-6xl mb-4">🏆</div>
                    <h2 class="text-2xl font-black text-slate-700 uppercase">Quiz Terminé !</h2>
                    <p class="text-lg font-bold text-indigo-600 mt-2">${pseudo}, ton score : ${score * 10} / 100</p>
                    <button onclick="location.reload()" class="mt-8 bg-indigo-500 text-white px-10 py-4 rounded-2xl font-black w-full uppercase">
                        Recommencer
                    </button>
                </div>`;
        }, 500);
    }

    function envoyerResultat(pseudoJoueur, scoreFinal) {
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbys_uz58mt03TDr5gthhtJIeZJqqJDTuikaHwUa60o2rp3S4jIOeuABIrjWyfUDuhEdLg/exec";
        
        const data = {
            nom: pseudoJoueur,
            score: scoreFinal * 10, // <--- SCORE SUR 100 ICI
            sujet: "Monte Cristo - Chapitre 2"
        };

        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            cache: "no-cache",
            body: JSON.stringify(data)
        });
    }

    window.onload = loadQuestion;
</script>
</body>
</html>