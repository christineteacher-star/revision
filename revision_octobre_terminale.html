<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fondamentaux du Récit | Académie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background-color: #f0f7ff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 85px; background: white; display: flex; flex-direction: column; align-items: center; padding: 25px 0; border-right: 1px solid #eef2f6; }
        .logo-dragon { width: 48px; height: 48px; background: #10b981; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: white; font-size: 22px; margin-bottom: 40px; cursor:pointer; }
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .game-card { background: white; border-radius: 35px; padding: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; max-width: 700px; }
        
        .opt-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px solid #f1f5f9; border-radius: 18px; text-align: left; font-weight: 600; transition: 0.2s; cursor: pointer; color: #475569; }
        .opt-btn:hover:not(:disabled) { background: #f0fdf4; border-color: #10b981; transform: translateX(5px); }
        
        .correct { background: #d1fae5 !important; color: #065f46 !important; border-color: #10b981 !important; }
        .wrong { background: #fee2e2 !important; color: #991b1b !important; border-color: #ef4444 !important; }
        
        #playerNameInput { background-color: #f1f5f9 !important; border: 2px solid #cbd5e1 !important; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo-dragon" onclick="window.location.href='index.html'"><i class="fas fa-dragon"></i></div>
        <div class="text-slate-300 hover:text-green-500 cursor-pointer" onclick="window.location.href='index.html'"><i class="fas fa-home text-2xl"></i></div>
    </nav>

    <main class="main-content">
        <div class="game-card">
            
            <div id="start-zone" class="text-center">
                <div class="w-20 h-20 bg-green-100 text-green-600 rounded-3xl flex items-center justify-center text-3xl mx-auto mb-6">
                    <i class="fas fa-book-open"></i>
                </div>
                <h2 class="text-3xl font-black text-slate-800 mb-2">Maîtrise du Récit</h2>
                <p class="text-slate-500 mb-8 px-10">Focalisation, temps verbaux et schémas narratifs. Prêt pour les 20 questions ?</p>
                
                <div class="max-w-xs mx-auto">
                    <input type="text" id="playerNameInput" placeholder="Ton Prénom" class="w-full p-4 rounded-2xl mb-4 text-center font-bold text-lg outline-none">
                    <button onclick="preStart()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-green-700 transition-all">DÉMARRER LE QUIZ</button>
                </div>
            </div>

            <div id="quiz-ui" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <span id="progress" class="bg-slate-100 text-slate-600 px-4 py-1 rounded-full text-xs font-bold uppercase">Question 1 / 20</span>
                    <div class="text-right">
                        <p class="text-slate-400 text-[10px] font-bold uppercase">Points</p>
                        <p id="score-display" class="text-2xl font-black text-green-600">0</p>
                    </div>
                </div>

                <h3 id="q-text" class="text-xl font-bold text-slate-800 mb-6 leading-tight"></h3>
                <div id="options" class="space-y-3"></div>
                
                <div id="feedback" class="mt-6 p-4 rounded-2xl text-sm hidden border-l-8"></div>
                
                <button id="next-btn" class="hidden w-full mt-6 bg-slate-800 text-white py-4 rounded-2xl font-bold hover:bg-slate-900 transition">QUESTION SUIVANTE &rarr;</button>
            </div>

            <div id="final-screen" class="hidden text-center">
                <div class="w-20 h-20 bg-yellow-100 text-yellow-600 rounded-3xl flex items-center justify-center text-3xl mx-auto mb-6">
                    <i class="fas fa-star"></i>
                </div>
                <h2 class="text-3xl font-black text-slate-800 mb-2">Félicitations !</h2>
                <p class="text-slate-500 mb-6">Ton score a été enregistré.</p>
                <div class="text-6xl font-black text-green-600 mb-8" id="final-score">0 / 20</div>
                
                <div class="flex flex-col gap-3">
                    <button onclick="window.location.href='index.html'" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold">RETOUR ACCUEIL</button>
                    <button onclick="location.reload()" class="w-full bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold">REJOUER</button>
                </div>
            </div>

        </div>
    </main>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbys_uz58mt03TDr5gthhtJIeZJqqJDTuikaHwUa60o2rp3S4jIOeuABIrjWyfUDuhEdLg/exec";
        
        const questions = [
            { q: "Quel type de focalisation est utilisé lorsque le narrateur est un personnage et ne sait rien de plus que lui ?", o: ["Focalisation interne", "Focalisation externe", "Focalisation omnisciente"], r: 0 },
            { q: "Procédé consistant à commencer un récit directement au milieu de l'action ?", o: ["Prolepse", "In medias res", "Analepse"], r: 1 },
            { q: "Temps verbal utilisé pour le décor ou une action habituelle ?", o: ["Le Présent", "Le Passé Simple", "L'Imparfait"], r: 2 },
            { q: "Événement qui rompt l'équilibre de la situation initiale ?", o: ["L'élément perturbateur", "Le dénouement", "Les péripéties"], r: 0 },
            { q: "L'énonciation à la première personne (« Je ») transmet :", o: ["Une objectivité totale", "La subjectivité du personnage", "Le point de vue du lecteur"], r: 1 },
            { q: "Fonction du récit cherchant à transmettre une leçon de vie ?", o: ["Fonction d'information", "Fonction de fiction", "Fonction de moralité"], r: 2 },
            { q: "La narration rétrospective est synonyme de :", o: ["Analepse", "Prolepse", "Isocolie"], r: 0 },
            { q: "Dans un récit à la 3e personne, le narrateur est-il l'auteur ?", o: ["Oui, absolument", "Seulement chez Victor Hugo", "Non, ce sont deux entités distinctes"], r: 2 },
            { q: "Discours utilisant guillemets et tirets pour les paroles exactes ?", o: ["Discours indirect", "Discours direct", "Discours indirect libre"], r: 1 },
            { q: "Lequel est un connecteur chronologique essentiel ?", o: ["Puis", "Donc", "Mais"], r: 0 },
            { q: "Focalisation où le narrateur agit comme une caméra (pas de pensées) ?", o: ["Interne", "Omnisciente", "Externe"], r: 2 },
            { q: "« J'ai de l'argent, ma masse » est un exemple de :", o: ["Description", "Discours rapporté", "Argumentation"], r: 1 },
            { q: "Temps exprimant une action antérieure à une autre action passée ?", o: ["Le Plus-que-Parfait", "Le Passé Antérieur", "Le Futur Antérieur"], r: 0 },
            { q: "La 3e personne (« Il ») est-elle compatible avec la foc. interne ?", o: ["Oui, si on suit la perception d'un seul perso", "Non, c'est forcément omniscient", "Non, c'est forcément externe"], r: 0 },
            { q: "Étape où le problème est résolu ?", o: ["Situation initiale", "Péripéties", "Dénouement"], r: 2 },
            { q: "Composante marquée par l'Imparfait et les adjectifs ?", o: ["La description", "La narration", "L'explication"], r: 0 },
            { q: "L'analepse (flashback) permet de :", o: ["Anticiper le futur", "Raconter un événement passé", "Ralentir le rythme"], r: 1 },
            { q: "Dans un récit au passé, le Passé Simple marque :", o: ["La répétition", "La durée", "Les actions ponctuelles de l'intrigue"], r: 2 },
            { q: "Un récit peut-il avoir une fonction argumentative ?", o: ["Oui (ex: fable/apologue)", "Non, jamais", "Seulement si l'auteur intervient"], r: 0 },
            { q: "Narrateur qui sait tout (passé, présent, pensées) ?", o: ["Interne", "Omnisciente / Zéro", "Externe"], r: 1 }
        ];

        let currentIndex = 0, score = 0, pseudo = "";

        function preStart() {
            const input = document.getElementById('playerNameInput');
            if(input.value.trim().length < 2) return alert("Entre ton prénom !");
            pseudo = input.value.trim();
            document.getElementById('start-zone').classList.add('hidden');
            document.getElementById('quiz-ui').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const data = questions[currentIndex];
            document.getElementById('progress').innerText = `Question ${currentIndex + 1} / ${questions.length}`;
            document.getElementById('q-text').innerText = data.q;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const box = document.getElementById('options');
            box.innerHTML = "";
            data.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "opt-btn";
                b.innerText = opt;
                b.onclick = () => check(i, b);
                box.appendChild(b);
            });
        }

        function check(idx, btn) {
            const data = questions[currentIndex];
            const btns = document.getElementsByClassName('opt-btn');
            for(let b of btns) b.disabled = true;

            const f = document.getElementById('feedback');
            f.classList.remove('hidden');
            
            if(idx === data.r) {
                score++;
                btn.classList.add('correct');
                f.className = "mt-6 p-4 rounded-2xl text-sm border-l-8 bg-green-50 text-green-700 border-green-500";
                f.innerHTML = "<b>Bravo !</b> C'est la bonne réponse.";
            } else {
                btn.classList.add('wrong');
                f.className = "mt-6 p-4 rounded-2xl text-sm border-l-8 bg-red-50 text-red-700 border-red-500";
                f.innerHTML = `<b>Erreur...</b> La réponse était : ${data.o[data.r]}`;
            }
            document.getElementById('score-display').innerText = score;
            document.getElementById('next-btn').classList.remove('hidden');
        }

        document.getElementById('next-btn').onclick = () => {
            currentIndex++;
            if(currentIndex < questions.length) loadQuestion();
            else finish();
        };

        async function finish() {
            document.getElementById('quiz-ui').classList.add('hidden');
            document.getElementById('final-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
            
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ nom: pseudo, score: score * 5, quiz: "Fondamentaux du Récit" })
                });
            } catch (e) { console.error(e); }
        }
    </script>
</body>
</html>
