<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecteur DELF Niveau 1 | Acad√©mie Dragon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background: #f8fafc; overflow-x: hidden; }
        .word { font-size: 1.3rem; margin: 0 3px; color: #94a3b8; transition: all 0.2s; display: inline-block; border-radius: 6px; padding: 0 3px; line-height: 2.2rem; }
        .word.current { color: #3b82f6 !important; font-weight: 700; background: #dbeafe; border-bottom: 3px solid #3b82f6; }
        .word.read { color: #10b981 !important; font-weight: 600; }
        .word.skipped { color: #ef4444 !important; text-decoration: line-through; opacity: 0.6; font-weight: 700; }
        
        .sidebar { width: 85px; height: 100vh; background: white; border-right: 1px solid #e2e8f0; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; align-items: center; padding: 25px 0; z-index: 100; }
        .main-container { margin-left: 85px; padding: 1rem; }
        
        .themes-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; justify-content: center; }
        .themes-row::-webkit-scrollbar { height: 4px; }
        
        @media (max-width: 1024px) {
            .sidebar { width: 100%; height: 60px; flex-direction: row; position: relative; padding: 0 20px; justify-content: space-between; border-right: none; border-bottom: 1px solid #e2e8f0; }
            .main-container { margin-left: 0; padding: 0.5rem; }
            .themes-row { justify-content: flex-start; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <a href="index.html" class="w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center text-white shadow-lg mb-8 hover:scale-110 transition-transform">
            <i class="fas fa-dragon text-2xl"></i>
        </a>
        <a href="index.html" class="text-slate-400 hover:text-red-500"><i class="fas fa-home text-2xl"></i></a>
    </nav>

    <div class="main-container">
        <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-5 border border-slate-200">
            
            <header class="text-center mb-2">
                <h1 class="text-xl font-black text-slate-800 tracking-tight uppercase">Lecteur Acad√©mie Dragon - Niveau 1</h1>
                <p id="status-msg" class="text-blue-600 font-bold text-[10px] h-3 uppercase"></p>
            </header>

            <div class="themes-row mb-4">
                <button onclick="loadLevel('A1_Presentation')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 border border-orange-100 rounded-full font-bold text-[11px] hover:bg-orange-500 hover:text-white transition">A1 Moi</button>
                <button onclick="loadLevel('A1_Famille')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 border border-orange-100 rounded-full font-bold text-[11px] hover:bg-orange-500 hover:text-white transition">A1 Famille</button>
                <button onclick="loadLevel('A1_Journee')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-orange-700 border border-orange-100 rounded-full font-bold text-[11px] hover:bg-orange-500 hover:text-white transition">A1 Journ√©e</button>
                <div class="w-[1px] bg-slate-200 mx-1"></div>
                <button onclick="loadLevel('A2_Sante')" class="whitespace-nowrap px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-full font-bold text-[11px] hover:bg-emerald-500 hover:text-white transition">A2 Sant√©</button>
                <button onclick="loadLevel('A2_Voyage')" class="whitespace-nowrap px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-full font-bold text-[11px] hover:bg-emerald-500 hover:text-white transition">A2 Voyage</button>
                <button onclick="loadLevel('A2_Loisirs')" class="whitespace-nowrap px-3 py-1.5 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-full font-bold text-[11px] hover:bg-emerald-500 hover:text-white transition">A2 Loisirs</button>
            </div>

            <div id="text-zone" class="bg-slate-50 rounded-2xl p-6 text-justify min-h-[320px] max-h-[380px] overflow-y-auto border border-slate-100 shadow-inner"></div>

            <div class="mt-4 flex flex-col items-center gap-3">
                <div id="attempts-badge" class="bg-orange-50 text-orange-600 px-4 py-1 rounded-full text-xs font-bold border border-orange-100">
                    Essais : <span id="count-val">0</span>/3
                </div>
                
                <div class="flex gap-6 pb-2">
                    <button id="mic-toggle" onclick="toggleSpeech()" class="w-12 h-12 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center text-lg hover:scale-110 transition">
                        <i class="fas fa-microphone" id="mic-icon"></i>
                    </button>
                    <button onclick="handleManualHelp()" class="w-12 h-12 bg-slate-800 text-white rounded-full shadow-lg flex items-center justify-center text-lg hover:scale-110 transition">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const texts = {
            'A1_Presentation': "Bonjour √† tous. Je m'appelle Thomas et j'ai vingt ans. Je suis √©tudiant √† l'universit√© de Lyon. J'habite dans un petit appartement avec un ami. J'aime beaucoup apprendre les langues √©trang√®res comme le fran√ßais et l'espagnol. Le matin, je mange des c√©r√©ales avec du lait. Je parle souvent avec mes voisins dans la rue. Le soir, je regarde la t√©l√©vision ou je lis un livre. Je suis tr√®s heureux de faire votre connaissance aujourd'hui.",
            'A1_Famille': "Dans ma famille, nous sommes quatre personnes. Mon p√®re s'appelle Marc et ma m√®re s'appelle Marie. J'ai une petite s≈ìur qui va encore √† l'√©cole primaire. Nous habitons dans une grande maison avec un beau jardin vert. Mes grands-parents habitent dans la m√™me ville que nous. Le dimanche, nous mangeons tous ensemble dans la cuisine. Mon chat attend toujours derri√®re la porte pour entrer. J'aime passer du temps avec mes parents et mes amis.",
            'A1_Journee': "Ma journ√©e commence normalement √† sept heures du matin. Je prends une douche rapide et je pr√©pare mon caf√©. Je pars √† l'universit√© en bus √† huit heures. Les cours finissent souvent √† seize heures de l'apr√®s-midi. Apr√®s les cours, je vais au parc pour marcher un peu. Je fais mes devoirs sur mon ordinateur dans ma chambre. Je d√Æne avec mon colocataire √† dix-neuf heures. Je me couche t√¥t pour √™tre en forme le lendemain.",
            'A2_Sante': "Pour rester en excellente sant√©, il est indispensable de faire attention √† son alimentation quotidienne. Les m√©decins expliquent qu'il faut manger des fruits et des l√©gumes chaque jour. Cela apporte des vitamines pour donner de l'√©nergie au corps. Boire beaucoup d'eau est √©galement un geste essentiel pour rester hydrat√©. L'activit√© physique joue un r√¥le majeur dans notre bien-√™tre. Marcher trente minutes chaque matin suffit pour prot√©ger votre c≈ìur. Le sommeil ne doit pas √™tre oubli√© pour bien r√©cup√©rer.",
            'A2_Voyage': "L'√©t√© dernier, je suis parti en vacances avec ma famille au bord de la mer. Nous avons lou√© une petite maison situ√©e face √† la plage de sable. Chaque matin, nous achetons des croissants chauds √† la boulangerie du village. Les enfants jouent dans les vagues pendant que les adultes lisent des livres. √Ä midi, nous pr√©parons des salades avec des produits achet√©s au march√©. L'apr√®s-midi, nous faisons des promenades pour admirer les bateaux. C'√©tait un s√©jour incroyable.",
            'A2_Loisirs': "Pendant mon temps libre, j'aime consacrer mes heures √† des activit√©s vari√©es. Le samedi apr√®s-midi, je vais au cin√©ma de mon quartier avec mon meilleur ami. Nous aimons beaucoup regarder les nouvelles com√©dies fran√ßaises. Quand il fait beau, nous organisons des parties de football dans le grand parc. C'est un excellent moyen de rester en forme en s'amusant. Le dimanche, je pr√©f√®re rester √† la maison pour lire ou √©couter de la musique. Ces plaisirs sont importants pour se d√©tendre.",
        };

        const verbsENT = ["mangent", "habitent", "parlent", "regardent", "pr√©parent", "finissent", "attendent", "ach√®tent", "jouent", "lisent", "expliquent", "apportent"];

        let words = [];
        let currentIdx = 0;
        let attempts = 0;
        let isActive = false;
        let recognition;
        const synth = window.speechSynthesis;

        if (window.SpeechRecognition || window.webkitSpeechRecognition) {
            const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new Speech();
            recognition.lang = 'fr-FR';
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.onresult = (e) => {
                let heard = Array.from(e.results).slice(e.resultIndex).map(res => res[0].transcript).join('').toLowerCase();
                evaluate(heard);
            };
            recognition.onend = () => { if(isActive) recognition.start(); };
        }

        function loadLevel(lvl) {
            words = texts[lvl].split(/\s+/);
            currentIdx = 0; attempts = 0;
            const zone = document.getElementById('text-zone');
            zone.innerHTML = '';
            words.forEach((w, i) => {
                const s = document.createElement('span');
                s.id = 'wd-' + i;
                s.className = 'word';
                s.innerText = w;
                zone.appendChild(s);
            });
            updateFocus();
        }

        function updateFocus() {
            document.querySelectorAll('.word').forEach(s => s.classList.remove('current'));
            const c = document.getElementById('wd-' + currentIdx);
            const status = document.getElementById('status-msg');
            if (c) {
                c.classList.add('current');
                c.scrollIntoView({behavior: "smooth", block: "center"});
                let clean = words[currentIdx].toLowerCase().replace(/[.,!?;:]/g, "");
                if (verbsENT.includes(clean)) status.innerText = "üí° Verbe pluriel : le '-ent' est muet !";
                else if (clean.endsWith("ent") || clean.endsWith("ant")) status.innerText = "üîî Sonore : [AN]";
                else status.innerText = "";
            }
            document.getElementById('count-val').innerText = attempts;
        }

        function evaluate(said) {
            if (currentIdx >= words.length) return;
            let target = words[currentIdx].toLowerCase().replace(/[.,!?;:]/g, "");
            let heardArray = said.toLowerCase().split(/\s+/);
            let lastWord = heardArray[heardArray.length - 1];
            if (verbsENT.includes(target) && (said.includes(" en") || said.includes(" an"))) return;
            let isMatch = false;
            if (verbsENT.includes(target)) { if (lastWord.startsWith(target.slice(0, -3))) isMatch = true; }
            else { if (said.includes(target)) isMatch = true; }
            if (isMatch) { document.getElementById('wd-' + currentIdx).classList.add('read'); moveToNext(); }
        }

        function handleManualHelp() {
            if (currentIdx >= words.length) return;
            const utterance = new SpeechSynthesisUtterance(words[currentIdx]);
            utterance.lang = 'fr-FR';
            synth.speak(utterance);
            attempts++;
            if (attempts >= 3) { document.getElementById('wd-' + currentIdx).classList.add('skipped'); setTimeout(moveToNext, 800); }
            else { updateFocus(); }
        }

        function moveToNext() { attempts = 0; currentIdx++; updateFocus(); }

        function toggleSpeech() {
            if (!isActive) {
                recognition.start(); isActive = true;
                document.getElementById('mic-toggle').classList.replace('bg-blue-600', 'bg-red-500');
            } else {
                recognition.stop(); isActive = false;
                document.getElementById('mic-toggle').classList.replace('bg-red-500', 'bg-blue-600');
            }
        }
        loadLevel('A1_Presentation');
    </script>
</body>
</html>
